#include <WaveHC.h>
#include <WaveUtil.h>
const int lightPin = A3;
const int moisturePin = A2; 
const int tmpPin=A1;

SdReader card;    // This object holds the information for the card
FatVolume vol;    // This holds the information for the partition on the card
FatReader root;   // This holds the information for the volumes root directory
FatReader file;   // This object represent the WAV file for a pi digit or period
WaveHC wave;      // This is the only wave (audio) object, since we will only play one at a time

#define error(msg) error_P(PSTR(msg))

void setup() {

 Serial.begin(9600);// Initialize serial communication  // set up Serial library at 9600 bps
  
  
  PgmPrintln("Pi speaker");
  
  if (!card.init()) {
    error("Card init. failed!");
  }
  if (!vol.init(card)) {
    error("No partition!");
  }
  if (!root.openRoot(vol)) {
    error("Couldn't open dir");
  }

  PgmPrintln("Files found:");
  root.ls();
}
void loop() {  
   Serial.println(Tdetect());  
}



int Ldetect(){
    int light;
    light = analogRead(lightPin);//read the data from potpin which
    light=map(light,0,1023,0,3);
    playcomplete("lig.wav");//***this line is not finished
    if(light==0)
    {
      playcomplete("low.wav");
    }
    else if (light == 1)
    {
      playcomplete("mid.wav");
    }
    else if (light ==2 )
    {
      playcomplete("high.wav");
    }
    else if ( light ==3)
    {
      playcomplete("vhigh.wav");
    }
    return light;
  
}



int Tdetect(){
  int reading; //raw reading from A1 
  float volts;//Voltage output number 
  float celsius; //celsius output number
   reading = analogRead(tmpPin); //read A1
   volts = reading/1023.0 * 5.0;
   celsius=volts*100.0-50; 
   playcomplete("tmp.wav");//** imcomplete;
   numberSp(celsius);
   playcomplete("cel.wav");//** imcomplete
   
   return celsius;
}




int Sdetect(){
   int tempValue = 0; // variable to temporarly store moisture value 
   for (int a = 0; a < 10; a++) { 
     tempValue += analogRead(moisturePin); 
     delay(100); 
   } 
   tempValue=tempValue/10;
   tempValue=(tempValue,0,1023,0,3);
   playcomplete("soi");//** imcomplete;
    if(tempValue==0)
    {
      playcomplete("low.wav");
    }
    else if (tempValue == 1)
    {
      playcomplete("mid.wav");
    }
    else if (tempValue ==2 )
    {
      playcomplete("high.wav");
    }
    else if ( tempValue ==3)
    {
      playcomplete("vhigh.wav");
    }
   return tempValue; 
}













///////////PLAY PART/////////////

void error_P(const char *str) {
  PgmPrint("Error: ");
  SerialPrint_P(str);
  sdErrorCheck();
  while(1);
}

void playcomplete(char *name) {
  playfile(name);
  while (wave.isplaying);
  
  // see if an error occurred while playing
  sdErrorCheck();
}
/*
 * Open and start playing a WAV file
 */
void playfile(char *name) {
  if (wave.isplaying) {// already playing something, so stop it!
    wave.stop(); // stop it
  }
  if (!file.open(root, name)) {
    PgmPrint("Couldn't open file ");
    Serial.print(name); 
    return;
  }
  if (!wave.create(file)) {
    PgmPrintln("Not a valid WAV");
    return;
  }
  // ok time to play!
  wave.play();
}

//this part is for playing numbers;
char ten[6];
char one[6];
void numberSp(int i)
{
  if (i<0)
  {
    playcomplete("minus.wav");
    i=-i;
  }
  int tens = i/10;
  int ones = i - tens*10;
  char t = char(tens);
  char o = char(ones);
  if(tens != 0)
  {
    strcpy_P(ten, PSTR("00.WAV"));
    ten[0]=t;
    playcomplete(ten);
  }
  strcpy_P(one, PSTR("0.WAV"));
  one[0]=o;
  playcomplete(one);
}

void sdErrorCheck(void) {
  if (!card.errorCode()) return;
  PgmPrint("\r\nSD I/O error: ");
  Serial.print(card.errorCode(), HEX);
  PgmPrint(", ");
  Serial.println(card.errorData(), HEX);
  while(1);
}
